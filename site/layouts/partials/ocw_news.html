{{- $newsItems := getJSON (print (strings.TrimSuffix "/" (getenv "OCW_STUDIO_BASE_URL")) "/api/news/") -}}
{{ if $newsItems.items }}
    <div class="ocw-news standard-width container mx-auto">
        {{ $breakdowns := (dict "xs-sm" (dict "size" 1 "class" "d-flex d-md-none") "md" (dict "size" 2 "class" "d-none d-md-flex d-lg-none")) }}
        {{ range $breakpoint, $carouselInfo := $breakdowns }}
            {{ $itemsInCarousel := index $carouselInfo "size" }}
            {{ $breakpointVisibilityClass := index $carouselInfo "class" }}
            {{ $carouselId := (printf "news-carousel-%v" $breakpoint) }}
            <div class="{{ $breakpointVisibilityClass }}">
                <div id="{{ $carouselId }}" class="carousel slide">
                    <div class="carousel-header d-flex flex-row justify-content-between font-weight-bold text-uppercase">
                        <h2 class="branded"><span>OCW</span> News</h2>
                        {{ partial "carousel_controls.html" $carouselId }}
                    </div>
                    <div class="carousel-inner d-flex mt-2 px-0">
                        {{- range $index, $newsItem := (first 4 $newsItems.items) -}}
                            {{ $modulo := (mod $index $itemsInCarousel) }}
                            {{ $group := (div $index $itemsInCarousel) }}
                            {{ if eq $modulo 0 }}
                                <div class="carousel-item row {{ if eq $group 0 }}active{{ end }}">
                            {{ end }}
                                <div class="item-wrapper col-{{ (div 12 $itemsInCarousel) }}">
                                    <div class="item item-{{ $index }}"
                                         style="background: linear-gradient(to bottom, transparent, #777777), url({{ $newsItem.image }})">
                                        <a href="{{ $newsItem.link.text }}" class="py-2 px-3 text-white text-decoration-none">
                                            {{ $newsItem.title.text }}
                                        </a>
                                    </div>
                                </div>
                            {{ if (or (eq $modulo (sub $itemsInCarousel 1)) (eq $index (sub 4 1))) }}
                                </div>
                            {{ end }}
                        {{ end }}
                    </div>
                </div>
            </div>
        {{ end }}

        <div class="d-none d-lg-block">
            <h2 class="branded"><span>OCW</span> News</h2>
            <div class="d-grid items-grid">
                {{- range $index, $item := (first 4 $newsItems.items) -}}
                    <div class="item item-{{ $index }}"
                         style="background: linear-gradient(to bottom, transparent, #777777), url({{ $item.image }})">
                        <a href="{{ $item.link.text }}" class="py-2 px-3 text-white text-decoration-none">
                            {{ $item.title.text }}
                        </a>
                    </div>
                {{ end }}
            </div>
        </div>

        <div class="d-flex py-4">
            <div class="ml-auto">
                <a class="view-all-link" href="https://www.ocw-openmatters.org/">View All News Stories</a>
            </div>
        </div>
    </div>
{{ end }}
